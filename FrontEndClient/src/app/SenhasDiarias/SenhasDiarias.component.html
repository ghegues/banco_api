<div class="card-body">
  <div class="card-body" [formGroup]="filterDate">
    <div class="form-row">
      <div class="form-group">
        <label for="dtInicio" class="col-form-label">Data início</label>
        <div class="col-12">
          <input class="form-control" type="date" formControlName="dtInicio" id="dtInicio">
        </div>
      </div>
      <div class="form-group">
        <label for="dtFim" class="col-form-label">Data Fim</label>
        <div class="col-12">
          <input class="form-control" type="date" formControlName="dtFim" id="dtFim">
        </div>
      </div>
      <div class="form-group">
        <label for="btnPesquisaHora" class="col-form-label">&nbsp;</label>
        <button class="btn btn-primary form-control" id="btnPesquisaHora" (click)='pesquisarPorData()'><i
            class="fa fa-search"></i></button>
      </div>
    </div>
  </div>

  <div class="form-row" [formGroup]="filterForm">
    <div class="form-group">
      <label for="empresa" class="col-form-label">Empresa</label>
      <div class="col-12">
        <input type="text" class="form-control" (keyup)="applyFilter($event.target.value, 'empresa')"
          formControlName="Empresa" />
      </div>
    </div>
    <div class="form-group">
      <label for="Beneficiário" class="col-form-label">Beneficiário</label>
      <div class="col-12">
        <input type="text" class="form-control" (keyup)="applyFilter($event.target.value, 'beneficiario')"
          formControlName="Beneficiario" />
      </div>
    </div>
    <!-- <div class="form-group">
      <label for="Procedimento" class="col-form-label">Procedimento</label>
      <div class="col-12">
        <input type="text" class="form-control" (keyup)="applyFilter($event.target.value, 'procedimento')"
          formControlName="Procedimento" />
      </div>
    </div> -->
    <div class="form-group">
      <label for="btnLimpaFiltro" class="col-form-label">&nbsp;</label>
      <button class="btn btn-primary form-control" id="btnLimpaFiltro" (click)='limparFiltros()'>limpar filtros</button>
    </div>
    <div class="form-group col-md-12">
      <div class="form-check">
        <input type="checkbox" 
        id="minhasVpps"  
        name="minhasVpps" 
        class="form-check-input" 
        (change)="checkValueVpp($event.target.checked)"
        [checked]="isCheckedMostraVpps">
        <label for="minhasVpps" class="form-check-label">Mostrar somente minhas vpps</label>
      </div>
    </div>
  </div>

  <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows class="mat-elevation-z8">
    <!-- Id -->
    <ng-container matColumnDef="Data solicitação">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Data solicitação </th>
      <td mat-cell *matCellDef="let element"> {{element.dtSolicitacao | DateTimeFormatPipe }} &nbsp;
        <i class="fa fa-arrow-down"></i> </td>
    </ng-container>

    <ng-container matColumnDef="Empresa">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Empresa </th>
      <td mat-cell *matCellDef="let element">
        {{element.idEmpresaNavigation == null?"Não disponível" : element.idEmpresaNavigation.razaoSocial}} </td>
    </ng-container>

    <ng-container matColumnDef="Beneficiario">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Beneficiário </th>
      <td mat-cell *matCellDef="let element">
        <a routerLink="/beneficiario/{{element.idSeguradoNavigation.id}}">
          {{element.idSeguradoNavigation.nmSegurado }}
        </a>
      </td>
    </ng-container>

    <ng-container matColumnDef="Carater">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Carater </th>
      <td mat-cell *matCellDef="let element"> {{element.dsCaraterInternacao | NaoDisponivel }}&nbsp;
      </td>
    </ng-container>



    <ng-container matColumnDef="TipoProcedimento">
      <th mat-header-cell *matHeaderCellDef> Tipos de procedimento </th>
      <td mat-cell *matCellDef="let element">
        <span *ngFor="let item of element.procedimento_vpp">
          {{item}} <br>
        </span>
      </td>
    </ng-container>

    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
        <div class="example-element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
          <div class="example-element-description col-md-12">
            <div class="container">
              <div class="row">
                <table>
                  <thead>
                    <tr>
                      <td>Qtd procedimentos</td>
                      <td>Procedimento</td>
                      <td>Inclusão</td>
                      <td>Tipo procedimento</td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let detalhe of element.vppProcedimentos">
                      <td>{{detalhe.qtdProcedimento}}</td>
                      <td>{{detalhe.idProcedimentoGestoNavigation.descricao}}</td>
                      <td>{{detalhe.dtInclusao | DateTimeFormatPipe}}</td>
                      <td>{{detalhe.tipoProcedimento}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="Status">
      <th mat-header-cell *matHeaderCellDef> Status </th>
      <td mat-cell *matCellDef="let element">
        <select class="custom-select" (change)="changeStatus($event, template_cadastro, element.id)"
          [value]="element.statusNavigation.length == 0 ? 0 : element.statusNavigation[element.statusNavigation.length - 1].statusDetalheId">
          <option value="0" disabled>Classificar</option>
          <option *ngFor="let detalhe of StatusDetalhe" [value]="detalhe.id">
            {{detalhe.nome}}</option>
        </select>
      </td>
    </ng-container>

    <ng-container matColumnDef="Enfermeiro">
      <th mat-header-cell *matHeaderCellDef> Enfermeiro(a) </th>
      <td mat-cell *matCellDef="let element">
        <select class="custom-select" (change)="changeEnfermeiro($event, element.id)"
          [value]="element.idUsuario == null ? 0 : element.idUsuario">
          <option value="0" disabled>Atribuir</option>
          <option *ngFor="let enf of users" [value]="enf.id">
            {{enf.firstName}} {{enf.lastName}}
          </option>
        </select>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>

    <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" class="example-element-row"
      [class.example-expanded-row]="expandedElement === element"
      (click)="expandedElement = expandedElement === element ? null : element">
    </tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
  </table>
  <mat-paginator [pageSizeOptions]="[20, 50, 100]"></mat-paginator>

  <div bsModal #template_cadastro="bs-modal" class="modal fade" tabindex="-1" role="dialog"
    aria-labelledby="dialog-sizes-name1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 id="dialog-sizes-name1" class="modal-title pull-left">Alterar status</h4>
          <button type="button" class="close pull-right" (click)="template_cadastro.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" [formGroup]="DaysForm">
          <div *ngIf="!Detalhe.finalizado">
            Dias para o retorno: <input type="text" class="form-control col-md-3" formControlName="DaysToReturn" />
          </div>
          <div class="modal-footer d-flex">
            <button class="btn btn-secondary" (click)="template_cadastro.hide()">
              Fechar
            </button>
            <button class="btn btn-primary ml-alto" (click)="salvar(template_cadastro)">
              Salvar!
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>