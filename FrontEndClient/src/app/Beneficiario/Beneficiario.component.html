<h1>Dados do Beneficiário</h1>
<div *ngIf="beneficiario">
  <p>
    Nome: {{beneficiario.nmSegurado}}
  </p>
  <p>
    Empresa: {{empresaBeneficiario | NaoDisponivel  }}
  </p>
  <p>
    Operadora: {{operadoraBeneficiario | NaoDisponivel  }}
  </p>
  <p>
    Identificação: {{beneficiario.cdIdentificacao}}
  </p>

  <p>
    Qtde senhas: {{beneficiario.vpp.length}}
  </p>


  <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows class="mat-elevation-z8">

    <ng-container matColumnDef="Data solicitação">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Data solicitação </th>
      <td mat-cell *matCellDef="let element"> {{element.dtSolicitacao | DateTimeFormatPipe }} &nbsp; <i
          class="fas fa-arrow-down"></i> </td>
    </ng-container>

    <ng-container matColumnDef="Carater">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Carater </th>
      <td mat-cell *matCellDef="let element"> {{element.dsCaraterInternacao | NaoDisponivel }}&nbsp;
      </td>
    </ng-container>

    <ng-container matColumnDef="TipoProcedimento">
      <th mat-header-cell *matHeaderCellDef> Tipos de procedimento </th>
      <td mat-cell *matCellDef="let element">
        <span *ngFor="let item of element.vppProcedimentos">
          {{item.tipoProcedimento|NaoDisponivel }} <br>
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="UltimoStatus">
      <th mat-header-cell *matHeaderCellDef>Último status</th>
      <td mat-cell *matCellDef="let element">
        <div *ngIf="element.statusNavigation.length > 0; else elseBlock">
          {{element.statusNavigation[0].statusDetalhe.nome }} <br>
        </div>
        <ng-template #elseBlock>Sem status</ng-template>
      </td>
    </ng-container>

    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
        <div class="example-element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
          <div class="example-element-description col-md-12">
            <div class="container">
              <div class="row">
                <div *ngIf="element.statusNavigation.length > 0;">
                  <h4>Histórico de status</h4>
                  <span *ngFor="let item of element.statusNavigation; let i= index ;trackBy: trackByFn">
                    {{i+1}}º Status: {{item.statusDetalhe.nome }}  {{item.dataInclusao | DateTimeFormatPipe}} <br>
                  </span>
                </div>
              </div>
                <hr>
                <div class="row">
                  <h4>Histórico de procedimentos</h4>
                  <table>
                    <thead>
                      <tr>
                        <td><b>Qtd procedimentos</b></td>
                        <td><b>Procedimento</b></td>
                        <td><b>Inclusão</b></td>
                        <td><b>Tipo procedimento</b></td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let detalhe of element.vppProcedimentos">
                        <td>{{detalhe.qtdProcedimento}}</td>
                        <td>{{detalhe.procedimento}}</td>
                        <td>{{detalhe.dtInclusao | DateTimeFormatPipe}}</td>
                        <td>{{detalhe.tipoProcedimento | NaoDisponivel}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            </div>
          </div>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="Status">
      <th mat-header-cell *matHeaderCellDef> Status </th>
      <td mat-cell *matCellDef="let element">
        <select class="form-control col-md-4" (change)="changeStatus($event, template_cadastro, element.id)"
          [value]="element.statusNavigation.length == 0 ? 0 : element.statusNavigation[element.statusNavigation.length - 1].statusDetalheId">
          <option value="0" disabled>Classificar</option>
          <option *ngFor="let detalhe of StatusDetalhe" [value]="detalhe.id">
            {{detalhe.nome}}</option>
        </select>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>

    <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" class="example-element-row"
      [class.example-expanded-row]="expandedElement === element"
      (click)="expandedElement = expandedElement === element ? null : element">
    </tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
  </table>
  <mat-paginator [pageSizeOptions]="[20, 50, 100]"></mat-paginator>



</div>